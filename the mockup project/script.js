const screens = {
  en: {
    id: 0,
    name: 'en',
    images: [
      { imageId: 0, imageUrl: 'https://dl.dropboxusercontent.com/s/lm4seayujxkm25a/en_0.PNG?dl=0', title: '241 lessons', subtitle: 'Straightforward explanations' },
      { imageId: 1, imageUrl: 'https://dl.dropboxusercontent.com/s/zr6a06r0s39hc49/en_1.PNG?dl=0', title: '700 exercises', subtitle: '5500 questions' },
      { imageId: 2, imageUrl: 'https://dl.dropboxusercontent.com/s/7e39ldmelbiptjz/en_2.PNG?dl=0', title: '3 types of exercises', subtitle: 'quiz, puzzle, gap-fill' },
      { imageId: 3, imageUrl: 'https://dl.dropboxusercontent.com/s/x76ht7ga5202qx5/en_3.PNG?dl=0', title: 'Easy to use', subtitle: '' },
      { imageId: 4, imageUrl: 'https://dl.dropboxusercontent.com/s/v3ugzi5yq9ivfb1/en_4.PNG?dl=0', title: 'Do your homework later', subtitle: '' },
      { imageId: 5, imageUrl: 'https://dl.dropboxusercontent.com/s/xsbgclyl2i77xiq/en_5.PNG?dl=0', title: 'Dr French can suggest lessons\n- always adapted to your level -\nthat you can add to your\nhomework', subtitle: '' },
      { imageId: 6, imageUrl: 'https://dl.dropboxusercontent.com/s/hesioqkop8jwyps/en_6.PNG?dl=0', title: '25% of the content available\nfor free - No ads\nTry it!', subtitle: '' }
    ]
  },
  fr: {
    id: 1,
    name: 'fr',
    images: [
      { imageId: 0, imageUrl: 'https://dl.dropboxusercontent.com/s/xr1vnqp8915drfg/fr_0.PNG?dl=0', title: '241 leçons', subtitle: 'Explications simples et claires' },
      { imageId: 1, imageUrl: 'https://dl.dropboxusercontent.com/s/3o16t1jb6lxo3l5/fr_1.PNG?dl=0', title: '700 exercices', subtitle: '5500 questions' },
      { imageId: 2, imageUrl: 'https://dl.dropboxusercontent.com/s/2i98fxy9fnctj9n/fr_2.PNG?dl=0', title: "3 types d'exercices", subtitle: 'quiz, puzzle, texte à trous' },
      { imageId: 3, imageUrl: 'https://dl.dropboxusercontent.com/s/0mwl4b3t9olnq6x/fr_3.PNG?dl=0', title: 'Pratique et intuitif', subtitle: '' },
      { imageId: 4, imageUrl: 'https://dl.dropboxusercontent.com/s/gm0ectsdyjlewau/fr_4.PNG?dl=0', title: 'Faites vos devoirs plus tard', subtitle: '' },
      { imageId: 5, imageUrl: 'https://dl.dropboxusercontent.com/s/rg4jv8hq74a2mxr/fr_5.PNG?dl=0', title: 'Dr French peut vous proposer\ndes leçons - adaptées à votre\nniveau - à ajouter à vos devoirs', subtitle: '' },
      { imageId: 6, imageUrl: 'https://dl.dropboxusercontent.com/s/9t27fvhf8662dhz/fr_6.PNG?dl=0', title: '25% du contenu disponible\ngratuitement - Pas de pub\nEssayez !', subtitle: '' }
    ]
  },
  pt: {
    id: 2,
    name: 'pt',
    images: [
      { imageId: 0, imageUrl: 'https://dl.dropboxusercontent.com/s/0s6dd27kuguq533/pt_0.PNG?dl=0', title: '241 lições', subtitle: 'Explicações claras e simples' },
      { imageId: 1, imageUrl: 'https://dl.dropboxusercontent.com/s/cnpgvcrmigvx5nb/pt_1.PNG?dl=0', title: '700 exercícios', subtitle: '5500 questões' },
      { imageId: 2, imageUrl: 'https://dl.dropboxusercontent.com/s/anhdkghdu3dqrr0/pt_2.PNG?dl=0', title: "3 tipos de exercício", subtitle: 'quiz, puzzle, lacuna' },
      { imageId: 3, imageUrl: 'https://dl.dropboxusercontent.com/s/droh8sn8gidi20i/pt_3.PNG?dl=0', title: 'Fácil de usar', subtitle: '' },
      { imageId: 4, imageUrl: 'https://dl.dropboxusercontent.com/s/6p6s0s6x336i7hu/pt_4.PNG?dl=0', title: 'Faça seus deveres mais tarde', subtitle: '' },
      { imageId: 5, imageUrl: 'https://dl.dropboxusercontent.com/s/g357e6i6cibadeo/pt_5.PNG?dl=0', title: 'O Dr French pode sugerir lições\n- adaptadas ao seu nível -\npara adicionar aos seus deveres', subtitle: '' },
      { imageId: 6, imageUrl: 'https://dl.dropboxusercontent.com/s/xe3tcs3w0g0lwr0/pt_6.PNG?dl=0', title: '25% do conteúdo disponível\nde graça - sem anúncios\nBaixe!', subtitle: '' }
    ]
  },
  es: {
    id: 3,
    name: 'es',
    images: [
      { imageId: 0, imageUrl: 'https://dl.dropboxusercontent.com/s/811nk7v5wtjcn8d/es_0.PNG?dl=0', title: '241 lecciones', subtitle: 'Explicaciones claras y sencillas' },
      { imageId: 1, imageUrl: 'https://dl.dropboxusercontent.com/s/zrfdrjb0258cexg/es_1.PNG?dl=0', title: '700 ejercicios', subtitle: '5500 preguntas' },
      { imageId: 2, imageUrl: 'https://dl.dropboxusercontent.com/s/ffz22tye1emxgqc/es_2.PNG?dl=0', title: "3 tipos de ejercicio", subtitle: 'quiz, puzzle, lagunas' },
      { imageId: 3, imageUrl: 'https://dl.dropboxusercontent.com/s/4dm2kh45wj7b2mb/es_3.PNG?dl=0', title: 'Fácil de usar', subtitle: '' },
      { imageId: 4, imageUrl: 'https://dl.dropboxusercontent.com/s/nfjx0lawli36513/es_4.PNG?dl=0', title: 'Haga sus deberes más adelante', subtitle: '' },
      { imageId: 5, imageUrl: 'https://dl.dropboxusercontent.com/s/8c4pjxgnfeeprny/es_5.PNG?dl=0', title: 'El Dr French puede sugerir\nlecciones - adaptadas a su nivel -\npara añadir a sus deberes', subtitle: '' },
      { imageId: 6, imageUrl: 'https://dl.dropboxusercontent.com/s/8ak7w09q8mkbyl9/es_6.PNG?dl=0', title: '25% del contenido disponible\ngratis - sin anuncios\nDescargar!', subtitle: '' }
    ]
  },
  zh_tw: {
    id: 4,
    name: 'zh_tw',
    images: [
      { imageId: 0, imageUrl: 'https://dl.dropboxusercontent.com/s/vjqbymi9nqe6w8s/zh_tw_0.PNG?dl=0', title: '241 個單元', subtitle: '解釋精簡' },
      { imageId: 1, imageUrl: 'https://dl.dropboxusercontent.com/s/zba1dyjn1psilsj/zh_tw_1.PNG?dl=0', title: '700 組練習', subtitle: '5500 題' },
      { imageId: 2, imageUrl: 'https://dl.dropboxusercontent.com/s/ldv5m0nnliksx9i/zh_tw_2.PNG?dl=0', title: "3 種練習題型", subtitle: '選擇題、重組練習、填空練習' },
      { imageId: 3, imageUrl: 'https://dl.dropboxusercontent.com/s/8hg2cb08bhy5hjw/zh_tw_3.PNG?dl=0', title: '介面精簡，易於操作', subtitle: '' },
      { imageId: 4, imageUrl: 'https://dl.dropboxusercontent.com/s/c1vf7q1b7x7f66f/zh_tw_4.PNG?dl=0', title: '安排接下來的學習進度', subtitle: '' },
      { imageId: 5, imageUrl: 'https://dl.dropboxusercontent.com/s/7wit3d1e1dbjq14/zh_tw_5.PNG?dl=0', title: 'Dr French 會自動建議適合\n您程度的課程單元，\n並可將單元加入學習進度', subtitle: '' },
      { imageId: 6, imageUrl: 'https://dl.dropboxusercontent.com/s/pux6vfrsqiv0lym/zh_tw_6.PNG?dl=0', title: '25% 的課程皆免費，\n且無惱人廣告！\n 快來試用！', subtitle: '' }
    ]
  },
  zh_cn: {
    id: 5,
    name: 'zh_cn',
    images: [
      { imageId: 0, imageUrl: 'https://dl.dropboxusercontent.com/s/d7249lv5scbd6vk/zh_cn_0.PNG?dl=0', title: '241 个单元', subtitle: '解释精简' },
      { imageId: 1, imageUrl: 'https://dl.dropboxusercontent.com/s/49ho7vzfw761owh/zh_cn_1.PNG?dl=0', title: '700 组练习', subtitle: '5500 题' },
      { imageId: 2, imageUrl: 'https://dl.dropboxusercontent.com/s/8m88babust139md/zh_cn_2.PNG?dl=0', title: "3 种练习题型", subtitle: '选择题、重组练习、填空练习' },
      { imageId: 3, imageUrl: 'https://dl.dropboxusercontent.com/s/3dgpy0thpwv9u1p/zh_cn_3.PNG?dl=0', title: '介面精简，易于操作', subtitle: '' },
      { imageId: 4, imageUrl: 'https://dl.dropboxusercontent.com/s/rz1c86639cw428q/zh_cn_4.PNG?dl=0', title: '安排接下来的学习进度', subtitle: '' },
      { imageId: 5, imageUrl: 'https://dl.dropboxusercontent.com/s/a0pogxn0pyiug5x/zh_cn_5.PNG?dl=0', title: 'Dr French 会自动建议适合\n您程度的课程单元，\n并可将单元加入学习进度', subtitle: '' },
      { imageId: 6, imageUrl: 'https://dl.dropboxusercontent.com/s/wnd7n5g33mzng11/zh_cn_6.PNG?dl=0', title: '25% 的课程皆免费，\n且无恼人广告！\n快来试用！', subtitle: '' }
    ]
  }

};


// global scope (for filters)
let languageValue = "";
let phoneValue = ""


// attention le mockup a des dimensions de 1242x2308 alors que le canvas est de 1242x2208
var img = new Image();
img.crossOrigin = "Anonymous";
img.src = 'https://dl.dropboxusercontent.com/s/dqwmzsucjbis3lh/iphone_8plus_mockup_55_bis.png?dl=0' // iphone_8plus

/************************
Hiding the canvas-section
*************************/

// In case no language is selected
function showCanvas() {
  destroyCanvas();
  if (languageValue === "" || phoneValue === "") {
    // const canvasSection = document.querySelector('#canvas-section');
    // canvasSection.style.display = "none";
    console.log("naaaaah, les filtres sont pas remplis!")
  } else {
    // const canvasSection = document.querySelector('#canvas-section');
    // canvasSection.style.display = "flex";
    console.log("way to go, bro! On crée les canvas!")
    createCanvas();
  }
}


/*********************
Destruction des canvas
*********************/
function destroyCanvas() {
  const canvasToDestroy = document.querySelector('#canvas-section');
  canvasToDestroy.innerHTML = "";
}


/*******************
Création des canvas
*******************/

function createEmptyCanvas(i, parentCanvas) {
  // creating a div for the canvas and the button
  const childDiv = document.createElement('div');

  // creating a canvas
  const childCanvas = document.createElement('canvas');
  childCanvas.className = 'canvas';
  childCanvas.id = `canvas-${i}`;
  childCanvas.width = '1242';
  childCanvas.height = '2208';

  // creating a link for the button
  const childA = document.createElement('a');
  childA.className = 'button';
  childA.download = `en_iphone_55_${i}.png`;
  childA.id = `a-${i}`;

  // creating the button for the canvas
  const childButton = document.createElement('button');
  childButton.textContent = "Download";
  // childButton.id = `button-${i}`;

  // appending the canvas to the parent
  childDiv.appendChild(childCanvas);

  // appending the button to the link
  childA.appendChild(childButton);

  // appending the link to the div
  childDiv.appendChild(childA);

  // appending the div to the parent
  parentCanvas.appendChild(childDiv);

  // event listeners for the download buttons
  const downloadButtons = document.querySelectorAll('.button');
  for (let i = 0; i < downloadButtons.length; i++) {
    downloadButtons[i].addEventListener("click", function(){downloadIt(i)}, false);
  }
}


function addCanvasBackground(ctx) {
  // creating the background
  ctx.fillStyle = 'rgb(15, 98, 194)';
  ctx.fillRect(0, 0, 1242, 2208);
}

// Dans le canevas iphone 8plus bis, l'image à uploader commence en "132, 277" et se termine en "1109, 2022"
// 1109 - 132 = 977
// 2022 - 277 = 1745

function createCanvas() {

  console.log("Okay, on commence à créer!");
  // On crée 7 canevas, chacun avec une id unique et un classname commun
  // Ils sont tous childs de #canvas-section

  // sélection du parent
  const parentCanvas = document.querySelector('#canvas-section');

  console.log("pouet");
  for (let i = 0; i < 7; i++) {

    createEmptyCanvas(i, parentCanvas);

    // selecting the canvas for drawing
    const canvas = document.querySelector(`#canvas-${i}`);
    const ctx = canvas.getContext('2d');

    addCanvasBackground(ctx);

    if (i%2 === 0) {
      console.log(`${i} est pair`);

      // adding title
      ctx.fillStyle = 'white';
      ctx.font = '80px Arial';
      ctx.textAlign = 'center';

      let heightToDraw = 165;
      const title = screens[languageValue].images[i].title;
      const titleParts = title.split("\n");
      console.log(titleParts);

      for (let j = 0; j < titleParts.length; j++) {
        ctx.fillText(titleParts[j], 621, heightToDraw, 1242);
        // ajout d'un interligne title/title
        console.log("ajout d'un interligne title/title (il est à 105)");
        heightToDraw += 105;
      }

      // defining subtitle
      ctx.font = '65px Arial';
      const subtitle = screens[languageValue].images[i].subtitle;
      const subtitleParts = subtitle.split("\n");
      console.log(subtitleParts);

      if (subtitle !== "") {
        // complément pour l'interligne title/subtitle
        console.log("ajout d'un interligne title/subtitle (il est à 0)");
        heightToDraw += 0;

        // adding subtitle
        for (let k = 0; k < subtitleParts.length; k++) {
          ctx.fillText(subtitleParts[k], 621, heightToDraw, 1242);
          // ajout d'un interligne subtitle/subtitle NON VERIFIE - IL FAUT LE VERIFIER
          console.log("ajout d'un interligne subtitle/subtitle (il est à 33)");
          heightToDraw += 33;
        }

        // complément pour l'écart subtitle/mockup
        // ATTENTION SI L'INTERLIGNE SUBTITLE/SUBTITLE CHANGE, IL FAUT CHANGER CELUI-LA EN CONSEQUENCE
        console.log("complément pour l'écart subtitle/mockup (il est à 87)");
        heightToDraw += 87;
      } else {
        // complément pour l'écart title/mockup
        console.log("complément pour l'écart title/mockup (il est à 15)");
        heightToDraw += 15;
      }


      // adding the mockup to the canvas
      ctx.drawImage(img, 0, heightToDraw, 1242, 2308);

      // loading the screenshot
      const screenshotBis = new Image();
      screenshotBis.crossOrigin = "Anonymous";
      console.log(languageValue)
      screenshotBis.src = screens[languageValue].images[i].imageUrl;

      // adding the screenshot to the canvas
      heightToDraw += 277;
      screenshotBis.onload = function() {
        ctx.drawImage(screenshotBis, 132, heightToDraw, 977, 1745); // iphone 8 plus haut
      }




    } else {
      console.log(`${i} est impair`);

      // defining title et subtitle parts
      const title = screens[languageValue].images[i].title;
      const titleParts = title.split("\n");
      const subtitle = screens[languageValue].images[i].subtitle;
      const subtitleParts = subtitle.split("\n");

      // counting title et subtitle lines
      const countTitle = titleParts.length;
      let countSubtitle = 0;
      if (subtitle === "") {
        countSubtitle = 0;
      } else {
        countSubtitle = subtitleParts.length;
      }

      console.log(countTitle);
      console.log(countSubtitle);


      // heightToDraw = bas du document - nbr de title x (hauteur title + interligne title/title)
      //                                - nbr de subtitle x (hauteur subtitle + interligne subtitle/subtitle)
      //                                - ecart mockup/title
      //                                    s'il y a des subtitles :
      //                                    - interligne title/subtitle
      //                                    - complement ecart subtitle/bas de page
      //                                     OU  s'il n'y a pas de subtitle
      //                                    - complement ecart title/bas de page
      let heightToDraw = 2208;
      heightToDraw += - countTitle*(105) - countSubtitle*(90);
      if (countSubtitle > 0) {
        heightToDraw += - 0 - 35;
      } else {
        heightToDraw += - 20;
      }

      console.log("Starting to draw the mockup and screenshot");
      let heightToDrawImg = heightToDraw - 2308 - 160;

      // adding the mockup to the canvas
      ctx.drawImage(img, 0, heightToDrawImg, 1242, 2308);

      // adding the screenshot to the canvas
      const screenshotBis = new Image();
      screenshotBis.crossOrigin = "Anonymous";
      screenshotBis.src = screens[languageValue].images[i].imageUrl;

      // adding the screenshot to the canvas
      heightToDrawImg += 277;
      screenshotBis.onload = function() {
        ctx.drawImage(screenshotBis, 132, heightToDrawImg, 977, 1745); // iphone 8 plus haut
      }


      console.log(`Starting to draw text at ${heightToDraw}`);

      // adding title
      ctx.fillStyle = 'white';
      ctx.font = '80px Arial';
      ctx.textAlign = 'center';

      // let heightToDraw = 165;

      console.log(titleParts);

      for (let j = 0; j < titleParts.length; j++) {
        ctx.fillText(titleParts[j], 621, heightToDraw, 1242);
        // ajout d'un interligne title/title
        console.log("ajout d'un interligne title/title (il est à 105)");
        heightToDraw += 105;
      }

      // defining subtitle
      ctx.font = '65px Arial';

      console.log(subtitleParts);

      if (subtitle !== "") {
        // complément pour l'interligne title/subtitle
        console.log("ajout d'un interligne title/subtitle (il est à 0)");
        heightToDraw += 0;

        // adding subtitle
        for (let k = 0; k < subtitleParts.length; k++) {
          ctx.fillText(subtitleParts[k], 621, heightToDraw, 1242);
          // ajout d'un interligne subtitle/subtitle NON VERIFIE - IL FAUT LE VERIFIER
          console.log("ajout d'un interligne subtitle/subtitle (il est à 33)");
          heightToDraw += 33;
        }

        // complément pour l'écart subtitle/mockup
        // ATTENTION SI L'INTERLIGNE SUBTITLE/SUBTITLE CHANGE, IL FAUT CHANGER CELUI-LA EN CONSEQUENCE
        console.log("complément pour l'écart subtitle/mockup (il est à 87)");
        heightToDraw += 87;
      } else {
        // complément pour l'écart title/mockup
        console.log("complément pour l'écart title/mockup (il est à 15)");
        heightToDraw += 15;
      }







    }
  }

}




function downloadIt(bla) {
  console.log("fiiiiiire");

  const download = document.querySelector(`#a-${bla}`);
  const image = document.querySelector(`#canvas-${bla}`).toDataURL("image/png").replace("image/png", "image/octet-stream");
  download.setAttribute("href", image);

  console.log("the end");
}


function filterLanguage() {
  const value = document.querySelector('#language').value;
  console.log(value);
  languageValue = value;
  console.log(languageValue);

  showCanvas();
}

function filterPhone() {
  const value = document.querySelector('#phone').value;
  console.log(value);
  phoneValue = value;
  console.log(phoneValue);

  showCanvas();
}


window.onload = function() {
  //event listener for the language filter
  const languageFilter = document.querySelector('#language');
  languageFilter.addEventListener("change", filterLanguage, false);

  //event listener for the phone filter
  const phoneFilter = document.querySelector('#phone');
  phoneFilter.addEventListener("change", filterPhone, false);
}
